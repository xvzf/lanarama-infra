# Ansible managed

auto lo
iface lo inet loopback
{# Hacky but works :-P #}
{% if network.bgp.enabled %}
  up ip link add name bgp0 type bridge
  up ip link set bgp0 up
  up ip a a {{ network.bgp.v4.ip }} dev bgp0
  up ip a a {{ network.bgp.v6.ip }} dev bgp0
{% endif %}

{% if network.dhcp %}
{% for dev in network.dhcp.interfaces %}
allow-hotplug {{ dev.name }}
iface {{ dev.name }} inet dhcp
iface {{ dev.name }} inet6 auto

{% endfor %}
{% endif %}
{% if network.bgp.enabled %}
{% for dev in network.bgp.interfaces %}
iface {{ dev.name }} inet manual

{% endfor %}
{% endif %}
{% if network.static %}
{% for dev in network.static.interfaces %}
auto {{ dev.name }}

iface {{ dev.name }} inet static
  up ip a a {{ dev.v4.ip }} dev {{ dev.name }}
  up ip r a default via {{ dev.v4.gateway }}

iface {{ dev.name }} inet6 static
  address {{ dev.v6.ip }}
  netmask {{ dev.v6.netmask }}
  gateway {{ dev.v6.gateway }}

{% endfor %}
{% endif %}
